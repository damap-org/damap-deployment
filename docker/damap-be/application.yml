# custom config settings
# replace these in the config of your custom project or by overriding these variables
damap:
  env: ${DAMAP_BE_ENV} # override in your custom project with PROD for production deployment
  origins: https://${DAMAP_BE_HOSTNAME} # https://your.frontend.com,https://*.yourdomain.com

  auth:
    backend:
      url: http://keycloak:8080/auth/realms/damap
      client: "damap-be"
    frontend:
      url: https://${DAMAP_BE_HOSTNAME}/auth/realms/damap
      client: "damap"
    scope: "openid profile email offline_access microprofile-jwt roles personID" # your-backend-authentication-scope, including your variable for your user IDs
    user: "personID"

  datasource:
    url: ${DAMAP_DATASOURCE_URL:jdbc:postgresql://postgres:5432/${DAMAP_BE_DB_NAME}}
    db-kind: ${DAMAP_DATABASE_DB_KIND:postgresql}
    driver: ${DAMAP_DATASOURCE_DRIVER:org.postgresql.Driver}
    username: ${DAMAP_BE_DB_USER:damap}
    password: ${DAMAP_BE_DB_PASSWORD:pw4damap}
    dialect: ${DAMAP_DATASOURCE_DIALECT:org.hibernate.dialect.PostgreSQLDialect}

  repositories:
    # Zenodo, Open Science Framework, DRYAD, Mendeley Data
    recommendation:
      ["r3d100010468", "r3d100011137", "r3d100000044", "r3d100011868"]

  fits-url: http://fits-service:8080/fits
  gotenberg-url: http://gotenberg:3000

  fields:
    ethical-report-enabled: true

  invenio:
    disabled: ${DAMAP_BE_INVENIO_DISABLED:-true}
    shared-secret: ${DAMAP_BE_INVENIO_SHARED_SECRET:-thisIsAVerySecretKeyOfAtLeast32Chars}

  mock-endpoint-url: http://api-mock:80
  projects-service: default

  # The project description field DAMAP should use:
  elsevier-pure-description-classification: /dk/atira/pure/projectdescription
  # How Pure project contributor classifications map to DAMAP:
  elsevier-pure-contributor-role-classifications:
    # DAMAP supports the following roles:
    # DATA_COLLECTOR, DATA_CURATOR, DATA_MANAGER, DISTRIBUTOR, EDITOR, HOSTING_INSTITUTION, PRODUCER, PROJECT_LEADER,
    # PROJECT_MANAGER, PROJECT_MEMBER, REGISTRATION_AGENCY, REGISTRATION_AUTHORITY, RELATED_PERSON, RESEARCHER,
    # RESEARCH_GROUP, RIGHTS_HOLDER, SPONSOR, SUPERVISOR, WORK_PACKAGE_LEADER, PRINCIPAL_INVESTIGATOR,
    # PROJECT_COORDINATOR, OTHER
    /dk/atira/pure/member: PROJECT_MEMBER
  # Which Pure classification should be read as the project lead:
  elsevier-pure-project-lead-role-classification: /dk/atira/pure/projectlead
  ## HTTP backend:
  elsevier-pure-backend: http
  elsevier-pure-endpoint-url: "https://your-pure-instance.elsevierpure.com/ws/api"
  elsevier-pure-api-key: "your API key here"
  ## Alternatively, the file-based backend:
  # elsevier-pure-backend: file
  elsevier-pure-projects-file: "file:///path/to/projects.json"
  elsevier-pure-persons-file: "file:///path/to/persons.json"

  # Set up person lookups here:
  person-services:
    - display-text: "University"
      query-value: "UNIVERSITY"
      class-name: 'org.damap.base.integration.mock.MockUniversityPersonServiceImpl'

    - display-text: "ORCID"
      query-value: "ORCID"
      class-name: "org.damap.base.integration.orcid.ORCIDPersonServiceImpl"

invenio:
  disabled: ${damap.invenio.disabled}
  shared-secret: ${damap.invenio.shared-secret}

# general config settings
quarkus:
  http:
    cors:
      ~: true
      origins: ${damap.origins}
      headers: origin,content-type,accept,authorization
      access-control-max-age: 1
    # needed for the fits service. Specify how large a single file for upload may be.
    limits:
      max-body-size: 10M

  oidc:
    auth-server-url: ${damap.auth.backend.url}
    client-id: ${damap.auth.backend.client}
    token:
      issuer: ${damap.auth.frontend.url}

  datasource:
    jdbc:
      url: ${damap.datasource.url}
      driver: ${damap.datasource.driver}

    db-kind: ${damap.datasource.db-kind}
    username: ${damap.datasource.username}
    password: ${damap.datasource.password}

  hibernate-orm:
    dialect: ${damap.datasource.dialect}
    database:
      generation: none
    sql-load-script: no-file

  cache:
    caffeine:
      "repositories":
        expire-after-write: P1D
      "repository":
        expire-after-write: P1D

  liquibase:
    migrate-at-start: true
    change-log: org/damap/base/db/changeLog-root.yaml

  smallrye-openapi:
    info-title: DAMAP API

  swagger-ui:
    always-include: true # set to false if swagger-ui should only be available in dev mode
    oauth-client-id: ${damap.auth.frontend.client}

rest:
  mock-projects/mp-rest/url: ${damap.mock-endpoint-url}
  mock-persons/mp-rest/url: ${damap.mock-endpoint-url}
  fits/mp-rest/url: ${damap.fits-url}
  gotenberg/mp-rest/url: ${damap.gotenberg-url}
  r3data:
    repositories/mp-rest/url: https://www.re3data.org/api
    repositories/mp-rest/scope: jakarta.inject.Singleton
  openaire/mp-rest/url: http://api.openaire.eu/search/
  orcid:
    search/mp-rest/url: https://pub.orcid.org

"%dev":
  damap:
    origins: http://localhost:4200
    auth:
      backend:
        url: http://localhost:8087/realms/damap
    datasource:
      url: jdbc:postgresql://localhost:8088/damap
      db-kind: postgresql
      username: damap
      password: pw4damap
    mock-endpoint-url: http://localhost:8091
    fits-url: http://localhost:8089/fits
    gotenberg-url: http://localhost:3000

"%test":
  damap:
    repositories:
      recommendation: ["r3d100010468"] # Re3Data id(s)
  quarkus:
    datasource:
      db-kind: h2
      jdbc:
        driver: org.h2.Driver
        url: jdbc:h2:mem:test
    oidc:
      enabled: false
